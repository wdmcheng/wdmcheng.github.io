<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.min.css"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="lIvVe-dWSgK0DqmtiD_EGQIOEToYJN4JRgcnMobFBZo"><meta name="msvalidate.01" content="B94E796A28E4E527BF11B7D41F0BD62C"><meta name="baidu-site-verification" content="uEL01GcE1h"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//fonts.lug.ustc.edu.cn/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css?v=7.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.1"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.1"><link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.1.1",sidebar:{position:"left",display:"post",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!0,fancybox:!0,fastclick:!0,lazyload:!0,tabs:!0,motion:{enable:!0,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6923016589675745",enable_page_level_ads:!0})</script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/2000d974.js","daovoice"),daovoice("init",{app_id:"2000d974"}),daovoice("update")</script><meta name="description" content="技术需要沉淀，所以有了搭建博客的想法，本文记录一下我搭建这个博客的步骤，分享的同时，整理自己的思路。"><meta name="keywords" content="Hexo,NexT"><meta property="og:type" content="article"><meta property="og:title" content="记录一下本博客搭建过程"><meta property="og:url" content="https://www.wdmcheng.cn/记录一下本博客搭建过程/index.html"><meta property="og:site_name" content="Wdmcheng"><meta property="og:description" content="技术需要沉淀，所以有了搭建博客的想法，本文记录一下我搭建这个博客的步骤，分享的同时，整理自己的思路。"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-05-26T16:12:45.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="记录一下本博客搭建过程"><meta name="twitter:description" content="技术需要沉淀，所以有了搭建博客的想法，本文记录一下我搭建这个博客的步骤，分享的同时，整理自己的思路。"><link rel="alternate" href="/atom.xml" title="Wdmcheng" type="application/atom+xml"><link rel="canonical" href="https://www.wdmcheng.cn/记录一下本博客搭建过程/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>记录一下本博客搭建过程 | Wdmcheng</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-136949119-1"></script><script>var host=window.location.hostname;if("localhost"!==host){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-136949119-1")}</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?89e01f6f76a49ecdafe40cfeef5e52c8";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Wdmcheng</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Java Coder</h1></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签<span class="badge">16</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类<span class="badge">0</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档<span class="badge">4</span></a></li><li class="menu-item menu-item-top"><a href="/top/" rel="section"><i class="menu-item-icon fa fa-fw fa-signal"></i><br>阅读热度</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header> <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dkbWNoZW5n" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></span><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><div class="reading-progress-bar"></div><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.wdmcheng.cn/记录一下本博客搭建过程/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="雾都迷城"><meta itemprop="description" content="手握日月摘星晨，世间无我这般人……嗯……吹大了"><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Wdmcheng"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">记录一下本博客搭建过程</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-03-26 22:19:22" itemprop="dateCreated datePublished" datetime="2019-03-26T22:19:22+08:00">2019-03-26</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-05-27 00:12:45" itemprop="dateModified" datetime="2019-05-27T00:12:45+08:00">2019-05-27</time></span> <span id="/记录一下本博客搭建过程/" class="leancloud_visitors" data-flag-title="记录一下本博客搭建过程"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">11k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">10 分钟</span></div><div class="post-description">技术需要沉淀，所以有了搭建博客的想法，本文记录一下我搭建这个博客的步骤，分享的同时，整理自己的思路。</div></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ol><li>欢迎在文末留言，共同进步。</li><li>本文采用<span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo" title="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际<i class="fa fa-external-link"></i></span>(<span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8=" title="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0<i class="fa fa-external-link"></i></span>) 许可协议，转载请注明出处！</li></ol><h2 id="博客搭建"><a href="#博客搭建" class="headerlink" title="博客搭建"></a>博客搭建</h2><h3 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h3><ol><li>关于基础组件的安装，这里不做详细介绍了，可以查看官网<ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXQtc2NtLmNvbS8=" title="https://git-scm.com/">Git<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9ub2RlanMub3Jn" title="https://nodejs.org">Node.js<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv" title="https://hexo.io">Hexo<i class="fa fa-external-link"></i></span></li></ul></li><li><p>在 Shell 中（Windows 下可能需要使用 Git Bash）执行初始化命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo init hexo-blog</span><br><span class="line"><span class="built_in">cd</span> hexo-blog</span><br></pre></td></tr></table></figure><p>我这里使用的是 <code>yarn</code> 代替 <code>npm</code>，关于 <code>yarn</code> 的安装，参考<span class="exturl" data-url="aHR0cHM6Ly95YXJucGtnLmNvbS9lbi9kb2NzL2luc3RhbGw=" title="https://yarnpkg.com/en/docs/install">这里<i class="fa fa-external-link"></i></span><br>我用的 <code>Hexo</code> 版本是 3.8.0，不需要执行 <code>yarn install</code> 命令了，init 的时候就做完了，因此只需要 cd 到目录下即可</p></li><li>修改站点配置文件 <code>_config.yml</code>：</li></ol><table><thead><tr><th style="text-align:left">配置</th><th style="text-align:left">原值（默认值）</th><th style="text-align:left">修改值</th></tr></thead><tbody><tr><td style="text-align:left">title</td><td style="text-align:left">Hexo</td><td style="text-align:left">Wdmcheng</td></tr><tr><td style="text-align:left">subtitle</td><td style="text-align:left"></td><td style="text-align:left">Java Coder</td></tr><tr><td style="text-align:left">description</td><td style="text-align:left"></td><td style="text-align:left">手握日月摘星晨，世间无我这般人……嗯……吹大了</td></tr><tr><td style="text-align:left">author</td><td style="text-align:left">John Doe</td><td style="text-align:left">雾都迷城</td></tr><tr><td style="text-align:left">language</td><td style="text-align:left"></td><td style="text-align:left">zh-CN</td></tr><tr><td style="text-align:left">timezone</td><td style="text-align:left"></td><td style="text-align:left">Asia/Shanghai</td></tr><tr><td style="text-align:left">url</td><td style="text-align:left"><span class="exturl" data-url="aHR0cDovL3lvdXJzaXRlLmNvbQ==" title="http://yoursite.com">http://yoursite.com<i class="fa fa-external-link"></i></span></td><td style="text-align:left"><a href="https://www.wdmcheng.cn">https://www.wdmcheng.cn</a></td></tr><tr><td style="text-align:left">permalink</td><td style="text-align:left">:year/:month/:day/:title/</td><td style="text-align:left">:title</td></tr><tr><td style="text-align:left">new_post_name</td><td style="text-align:left">:title.md</td><td style="text-align:left">:year/:month/:day/:title.md</td></tr><tr><td style="text-align:left">post_asset_folder</td><td style="text-align:left">false</td><td style="text-align:left">true</td></tr><tr><td style="text-align:left">index_generator &gt; per_page</td><td style="text-align:left">10</td><td style="text-align:left">20</td></tr><tr><td style="text-align:left">per_page</td><td style="text-align:left">10</td><td style="text-align:left">20</td></tr></tbody></table><ol start="4"><li>启动服务器就可以预览看到效果：<br><code>hexo server</code></li><li>默认地址：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo0MDAw" title="http://localhost:4000"><code>http://localhost:4000</code><i class="fa fa-external-link"></i></span></li><li>能正常访问，就说明环境基本搭建成功了，可以进行下一步了，先根据提示按 <code>Ctrl+C</code> 终止服务运行</li></ol><h3 id="实施方案"><a href="#实施方案" class="headerlink" title="实施方案"></a>实施方案</h3><p>这里采用的是<span class="exturl" data-url="aHR0cHM6Ly93d3cuc2ltb245Ni5vbmxpbmUvMjAxOC8xMC8xMi9oZXhvLXR1dG9yaWFsLyMlRTYlOTYlQjklRTYlQTElODglRTQlQjglODklRUYlQkMlOUFHaXRodWJQYWdlcy1Db2RpbmdQYWdlcy0lRTUlOUYlOUYlRTUlOTAlOEQ=" title="https://www.simon96.online/2018/10/12/hexo-tutorial/#%E6%96%B9%E6%A1%88%E4%B8%89%EF%BC%9AGithubPages-CodingPages-%E5%9F%9F%E5%90%8D">遇见西门教程<i class="fa fa-external-link"></i></span>教程的实施方案三，采用 GithubPages + CodingPages 的方式，不过有些变化。我是部署到 <code>GitLabPages</code> 上，然后使用 <code>GitLab</code> 的镜像仓库功能推送到 <code>GitHub</code> 与 <code>Coding</code><br>至于 Pages 服务的配置及这些镜像配置就不多介绍了</p><h3 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h3><p>关于主题优化，详细的教程还是要参考<span class="exturl" data-url="aHR0cHM6Ly93d3cuc2ltb245Ni5vbmxpbmUvMjAxOC8xMC8xMi9oZXhvLXR1dG9yaWFsLyMlRTQlQjglQkIlRTklQTIlOTglRTQlQkMlOTglRTUlOEMlOTYtMQ==" title="https://www.simon96.online/2018/10/12/hexo-tutorial/#%E4%B8%BB%E9%A2%98%E4%BC%98%E5%8C%96-1">遇见西门的博客<i class="fa fa-external-link"></i></span></p><h4 id="应用主题"><a href="#应用主题" class="headerlink" title="应用主题"></a>应用主题</h4><ol><li>官网的<span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL3RoZW1lcy8=" title="https://hexo.io/themes/">主题页面<i class="fa fa-external-link"></i></span>很坑，有时候各种<code>404</code>，看不见预览，我直接 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlYXJjaD9xPWhleG8tdGhlbWU=" title="https://github.com/search?q=hexo-theme">Github 搜索<i class="fa fa-external-link"></i></span>。Star 数最高的是 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lpc3NuYW4vaGV4by10aGVtZS1uZXh0" title="https://github.com/iissnan/hexo-theme-next">NexT<i class="fa fa-external-link"></i></span> 主题，但是旧版的，我这里直接使用<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0" title="https://github.com/theme-next/hexo-theme-next">新版<i class="fa fa-external-link"></i></span></li><li><p>根据主题说明，下载安装主题，我直接安装的最新版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure></li><li><p>修改站点配置文件 <code>_config.yml</code> 的 <code>theme</code> 字段，为主题文件夹名称，我这里就是 <code>next</code>，这时候想看到效果需要重启服务了</p></li><li>不需要默认的 <code>landscape</code> 主题了，直接删除，执行命令 <code>rm -rf themes/landscape</code></li></ol><h4 id="主题修改与优化"><a href="#主题修改与优化" class="headerlink" title="主题修改与优化"></a>主题修改与优化</h4><p>因为主题是克隆的仓库，后续升级版本其实很方便，为了避免升级时候主题配置的处理太麻烦，因此采用<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvaGV4by10aGVtZS1uZXh0L2Jsb2IvbWFzdGVyL2RvY3MvemgtQ04vREFUQS1GSUxFUy5tZA==" title="https://github.com/theme-next/hexo-theme-next/blob/master/docs/zh-CN/DATA-FILES.md">数据文件<i class="fa fa-external-link"></i></span>的形式配置：</p><ol><li><p>执行下面命令，创建 <code>source/_data/</code> 目录，并将默认主题配置文件 <code>themes/next/_config.yml</code> 复制到 <code>source/_data/</code> 下，命名为 <code>next.yml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="built_in">source</span>/_data</span><br><span class="line">cp -p themes/next/_config.yml <span class="built_in">source</span>/_data/next.yml</span><br></pre></td></tr></table></figure></li><li><p>修改新的主题配置文件 <code>source/_data/next.yml</code>，将 <code>override</code> 修改为 <code>true</code></p></li></ol><h5 id="RSS-支持"><a href="#RSS-支持" class="headerlink" title="RSS 支持"></a>RSS 支持</h5><p>安装 <code>hexo-generator-feed</code> 插件，由 Hexo 自动生成订阅源并插入链接，不需要其他配置<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D hexo-generator-feed</span><br></pre></td></tr></table></figure><p></p><h5 id="修改主题样式"><a href="#修改主题样式" class="headerlink" title="修改主题样式"></a>修改主题样式</h5><ol><li>修改主题配置文件 <code>source/_data/next.yml</code>，将 <code>scheme</code> 修改为 <code>Gemini</code>，使用双子座主题样式</li><li>配置菜单显示文章数，修改 <code>menu_settings.badges</code> 为 <code>true</code></li><li>配置文章目录自动换行，修改 <code>toc.wrap</code> 为 <code>true</code></li><li>配置侧边栏显示 Back to Top 按钮，并显示阅读百分比，修改 <code>back2top</code> 下<ul><li><code>sidebar: true</code></li><li><code>scrollpercent: true</code></li></ul></li><li>配置 footer，修改 <code>footer</code> 下<ul><li><code>icon.name: heart</code></li><li><code>icon.animated: true</code></li></ul></li></ol><h5 id="主页文章只显示摘要"><a href="#主页文章只显示摘要" class="headerlink" title="主页文章只显示摘要"></a>主页文章只显示摘要</h5><p><code>auto_excerpt.enable: true</code></p><h5 id="记录文章阅读位置"><a href="#记录文章阅读位置" class="headerlink" title="记录文章阅读位置"></a>记录文章阅读位置</h5><p>打开 <code>save_scroll: true</code> 这个开关就可以在 <code>Cookie</code> 中保存文章的阅读位置，下次进入还会滚动到相同地方</p><h5 id="字数统计与阅读时长"><a href="#字数统计与阅读时长" class="headerlink" title="字数统计与阅读时长"></a>字数统计与阅读时长</h5><ol><li>执行命令 <code>yarn add -D hexo-symbols-count-time</code></li><li><p>修改站点配置文件 <code>_config.yml</code>，添加下面代码</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字数统计与阅读时长</span></span><br><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line"><span class="attr">  symbols:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  time:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  total_symbols:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  total_time:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  exclude_codeblock:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li><p>如果需要显示<code>站点总字数</code>与<code>站点阅读时长</code> 的文字，修改主题配置文件 <code>source/_data/next.yml</code>，将 <code>symbols_count_time.item_text_total</code> 设置为 <code>true</code></p></li></ol><h5 id="代码片段复制按钮"><a href="#代码片段复制按钮" class="headerlink" title="代码片段复制按钮"></a>代码片段复制按钮</h5><p>主题配置文件 <code>source/_data/next.yml</code> 中 <code>codeblock.copy_button.enable</code> 设置为 <code>true</code>，<code>codeblock.copy_button.show_result</code> 设置为 <code>true</code></p><h5 id="优化字库访问速度"><a href="#优化字库访问速度" class="headerlink" title="优化字库访问速度"></a>优化字库访问速度</h5><p>如果需要优化字库访问速度，可以使用国内字体镜像站 <code>fonts.lug.ustc.edu.cn</code> 代替默认的 <code>fonts.googleapis.com</code>，修改 <code>font</code> 下</p><ul><li><code>enable: true</code></li><li><code>host: //fonts.lug.ustc.edu.cn</code></li><li><code>global.family: Monda</code></li><li><code>headings.family: Roboto Slab</code></li><li><code>logo.family: Lobster Two</code></li><li><code>logo.size: 24</code></li><li><code>codes.family: PT Mono</code></li></ul><h5 id="配置菜单项"><a href="#配置菜单项" class="headerlink" title="配置菜单项"></a>配置菜单项</h5><ol><li><code>menu</code> 下，打开下面几项的注释<ul><li>about</li><li>tags</li><li>categories</li><li>schedule</li></ul></li><li><p>执行下面的命令，生成 <code>categories</code> <code>tags</code> <code>about</code> <code>schedule</code> 页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo new page categories</span><br><span class="line">hexo new page tags</span><br><span class="line">hexo new page about</span><br><span class="line">hexo new page schedule</span><br></pre></td></tr></table></figure></li><li><p>生成的文件路径如下</p><ul><li>source/categories/index.md</li><li>source/tags/index.md</li><li>source/about/index.md</li><li>source/schedule/index.md</li></ul></li><li>编辑 <code>source/categories/index.md</code> 与 <code>source/tags/index.md</code> 文件，在 <code>date</code> 下面添加一行，分别为 <code>type: categories</code> <code>type: tags</code>，然后再各添加一行 <code>comments: false</code> 禁止评论。</li><li>另外两个文件自己随意修改</li><li>编辑 <code>scaffolds/post.md</code> 模板文件，在 <code>title</code> 下新添一行 <code>description:</code>，在 <code>tags</code> 下新添一行 <code>categories:</code>，这样以后创建的文章都会自动添加这两个属性</li><li>还可添加日程表，使用 <code>Google Calendar</code>，需要梯子。详细配置参考<span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy9kb2NzL3RoZW1lLXNldHRpbmdzL2N1c3RvbS1wYWdlcy8=" title="https://theme-next.org/docs/theme-settings/custom-pages/">这里<i class="fa fa-external-link"></i></span>，注意主题配置文件中的 <code>calendar.calendar_id</code> 不一定要填写 Google 账号对应的 E-Mail，只需要填写一个<code>日历 ID</code>，一定要是<code>公开日历</code>，否则会报 <code>404</code></li></ol><h5 id="添加创作共用协议"><a href="#添加创作共用协议" class="headerlink" title="添加创作共用协议"></a>添加创作共用协议</h5><p>我这里使用的是 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo" title="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">by-nc-sa<i class="fa fa-external-link"></i></span>，因此配置 <code>creative_commons</code> 项</p><ul><li><code>sidebar: true</code></li><li><code>post: true</code></li><li><code>language: deed.zh</code></li></ul><h5 id="文章开始统一添加前言"><a href="#文章开始统一添加前言" class="headerlink" title="文章开始统一添加前言"></a>文章开始统一添加前言</h5><p>这里我写了个前言，添加一下授权协议说明，在每篇博文都默认添加，也可以手动关闭</p><ol><li><p>创建文件 <code>themes/next/layout/_custom/custom-post-preface.swig</code>，并输入如下内容，或者自行修改</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">"前言"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#前言"</span> <span class="attr">class</span>=<span class="string">"headerlink"</span> <span class="attr">title</span>=<span class="string">"前言"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>前言<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>欢迎在文末留言，共同进步。<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    本文采用<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"exturl"</span> <span class="attr">data-url</span>=<span class="string">"aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"</span> <span class="attr">title</span>=<span class="string">"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"</span>&gt;</span>署名 - 非商业性使用 - 相同方式共享 4.0 国际<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-external-link"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      (<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"exturl"</span> <span class="attr">data-url</span>=<span class="string">"aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="</span> <span class="attr">title</span>=<span class="string">"https://creativecommons.org/licenses/by-nc-sa/4.0/"</span>&gt;</span>CC BY-NC-SA 4.0<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-external-link"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>) 许可协议，转载请注明出处！</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编辑 <code>scaffolds/post.md</code> 模板文件，在 <code>categories</code> 下新添一行 <code>include_preface: true</code>，做为显示前言的开关，这样以后创建的文章都会自动添加，并且是打开状态，具体文章的标记改为 <code>false</code>，则那篇文章就不会显示前言</p></li><li><p>编辑 <code>themes/next/layout/_macro/post.swig</code> 文件，在下面所示的区域</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;#################&#125;</span><br><span class="line">&#123;### POST BODY ###&#125;</span><br><span class="line">&#123;#################&#125;</span><br></pre></td></tr></table></figure><p>找到非 <code>is_index</code> 的<code></code> ，在其上添加如下代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if post.include_preface %&#125;</span><br><span class="line">  &#123;% include '../_custom/custom-post-preface.swig' %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li></ol><h5 id="文章末尾统一添加结束标记"><a href="#文章末尾统一添加结束标记" class="headerlink" title="文章末尾统一添加结束标记"></a>文章末尾统一添加结束标记</h5><ol><li>创建文件 <code>themes/next/layout/_custom/passage-end-tag.swig</code>，并输入如下内容，或者自行修改<br><code>&lt;div style=&quot;text-align: center; color: #ccc; font-size: 14px;&quot;&gt;-------------本文结束&lt;i class=&quot;fa fa-paw&quot;&gt;&lt;/i&gt;感谢您的阅读-------------&lt;/div&gt;</code></li><li><p>在主题配置文件 <code>source/_data/next.yml</code> 中添加如下配置，这里是关闭的，随时开启，只需要将 <code>passage_end_tag.enable</code> 从 <code>false</code> 改为 <code>true</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文章结束标记（需修改主题，自己添加代码）</span></span><br><span class="line"><span class="attr">passage_end_tag:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></li><li><p>编辑 <code>themes/next/layout/_macro/post.swig</code> 文件，在下面所示的标记上面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;#####################&#125;</span><br><span class="line">&#123;### END POST BODY ###&#125;</span><br><span class="line">&#123;#####################&#125;</span><br></pre></td></tr></table></figure><p>添加如下代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.passage_end_tag.enable and not is_index %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;% include '../_custom/passage-end-tag.swig' %&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li></ol><h5 id="添加-GitHub-Banner"><a href="#添加-GitHub-Banner" class="headerlink" title="添加 GitHub Banner"></a>添加 GitHub Banner</h5><p>最大的同性交友网站 GitHub 地址还是要放的，方便其他人 Follow me。<br>找到 <code>github_banner</code> 项，修改以下配置</p><ul><li><code>enable: true</code></li><li><code>permalink: https://github.com/wdmcheng</code></li></ul><h5 id="添加搜索功能"><a href="#添加搜索功能" class="headerlink" title="添加搜索功能"></a>添加搜索功能</h5><ol><li><p>添加依赖，在 Shell 中执行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D hexo-generator-searchdb</span><br></pre></td></tr></table></figure></li><li><p>在站点配置文件 <code>_config.yml</code> 中，找到 <code>Extensions</code>，在后面添加</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搜索功能</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">search.xml</span></span><br><span class="line"><span class="attr">  field:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">  format:</span> <span class="string">html</span></span><br><span class="line"><span class="attr">  limit:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure></li><li><p>在主题配置文件 <code>source/_data/next.yml</code> 中，修改 <code>local_search.enable</code> 为 <code>true</code></p></li></ol><h5 id="移动设备适配"><a href="#移动设备适配" class="headerlink" title="移动设备适配"></a>移动设备适配</h5><p><code>mobile_layout_economy: true</code></p><h5 id="Safari-菜单栏着色"><a href="#Safari-菜单栏着色" class="headerlink" title="Safari 菜单栏着色"></a>Safari 菜单栏着色</h5><p><code>safari_rainbow: true</code></p><h5 id="自定义滚动条件支持"><a href="#自定义滚动条件支持" class="headerlink" title="自定义滚动条件支持"></a>自定义滚动条件支持</h5><p><code>custom_scrollbar: true</code></p><h5 id="添加特效"><a href="#添加特效" class="headerlink" title="添加特效"></a>添加特效</h5><ol><li>启用 <code>Canvas-nest</code>，在主题配置文件 <code>source/_data/next.yml</code> 中，修改 <code>canvas_nest.enable</code> 为 <code>true</code></li><li><p>配置 CDN 加速，修改 <code>vendors</code> 下的配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  canvas_nest:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js</span></span><br><span class="line"><span class="attr">  canvas_nest_nomobile:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest-nomobile.min.js</span></span><br></pre></td></tr></table></figure></li><li><p>我这里还添加了 <code>JavaScript 3D library</code>，在主题配置文件 <code>source/_data/next.yml</code> 中，下面几项配置，需要启用哪种特效，就将 <code>false</code> 改为 <code>true</code>，我这里都是暂时关闭的</p><ul><li>three_waves: false</li><li>canvas_lines: false</li><li>canvas_sphere: false</li></ul></li><li><p>配置 CDN 加速，修改 <code>vendors</code> 下的配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  three:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js</span></span><br><span class="line"><span class="attr">  three_waves:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three-waves.min.js</span></span><br><span class="line"><span class="attr">  canvas_lines:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/canvas_lines.min.js</span></span><br><span class="line"><span class="attr">  canvas_sphere:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/canvas_sphere.min.js</span></span><br></pre></td></tr></table></figure></li><li><p>使用 CDN 加速，安装 <code>Canvas-Ribbon</code>，修改主题配置文件 <code>source/_data/next.yml</code>，我这里没有启用，需要启用直接修改 <code>canvas_ribbon.enable</code> 为 <code>true</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  canvas_ribbon:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.min.js</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="修改动画"><a href="#修改动画" class="headerlink" title="修改动画"></a>修改动画</h5><p><code>motion.async</code> 默认为 <code>false</code>，这里修改为 <code>true</code>，感觉动画效果快一些</p><h5 id="添加-Live2D-动画角色"><a href="#添加-Live2D-动画角色" class="headerlink" title="添加 Live2D 动画角色"></a>添加 Live2D 动画角色</h5><ol><li><p>安装 <code>hexo-helper-live2d</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D hexo-helper-live2d</span><br></pre></td></tr></table></figure></li><li><p>在站点配置文件 <code>_config.yml</code> 中，找到 <code>Extensions</code>，在后面添加</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Live2D</span></span><br><span class="line"><span class="comment"># https://github.com/EYHN/hexo-helper-live2d</span></span><br><span class="line"><span class="attr">live2d:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># local，从本地加载，需要配置 pluginRootPath、pluginJsPath、pluginModelPath 三个属性；后面三种配置从网络加载，不需要配置</span></span><br><span class="line">  <span class="comment">#scriptFrom: local 默认</span></span><br><span class="line">  <span class="comment">#pluginRootPath: live2dw/ # 插件在站点上的根目录(相对路径)</span></span><br><span class="line">  <span class="comment">#pluginJsPath: lib/ # 脚本文件相对与插件根目录路径</span></span><br><span class="line">  <span class="comment">#pluginModelPath: assets/ # 模型文件相对与插件根目录路径</span></span><br><span class="line">  <span class="comment">#scriptFrom: jsdelivr # jsdelivr CDN</span></span><br><span class="line">  <span class="comment">#scriptFrom: unpkg # unpkg CDN</span></span><br><span class="line"><span class="attr">  scriptFrom:</span> <span class="attr">https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js</span></span><br><span class="line"><span class="attr">  tagMode:</span> <span class="literal">false</span> <span class="comment"># 标签模式, 是否仅替换 live2d tag 标签而非插入到所有页面中</span></span><br><span class="line"><span class="attr">  debug:</span> <span class="literal">false</span> <span class="comment"># 调试, 是否在控制台输出日志</span></span><br><span class="line"><span class="attr">  model:</span></span><br><span class="line">    <span class="comment"># 第一种需要安装相应的包才可用；第二种和第三种需要手动放置相关文件</span></span><br><span class="line">    <span class="comment">#use: live2d-widget-model-z16 # npm-module package name</span></span><br><span class="line">    <span class="comment">#use: miku # 博客根目录/live2d_models/ 下的目录名</span></span><br><span class="line">    <span class="comment">#use: ./wives/wanko # 相对于博客根目录的路径</span></span><br><span class="line"><span class="attr">    use:</span> <span class="attr">https://cdn.jsdelivr.net/npm/live2d-widget-model-haruto@1.x/assets/haruto.model.json</span> <span class="comment"># 自定义 URL，可设定 CDN</span></span><br><span class="line"><span class="attr">  display:</span></span><br><span class="line"><span class="attr">    position:</span> <span class="string">right</span></span><br><span class="line"><span class="attr">    width:</span> <span class="number">300</span></span><br><span class="line"><span class="attr">    height:</span> <span class="number">600</span></span><br><span class="line"><span class="attr">  mobile:</span></span><br><span class="line"><span class="attr">    show:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="主页文章添加阴影效果"><a href="#主页文章添加阴影效果" class="headerlink" title="主页文章添加阴影效果"></a>主页文章添加阴影效果</h5><p>编辑 <code>themes/next/source/css/_custom/custom.styl</code> 文件，添加下面代码，我这里注释掉了，取消注释可以启用阴影<br></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 主页文章添加阴影效果</span><br><span class="line"><span class="comment">/*.post &#123;</span></span><br><span class="line"><span class="comment">  margin-top: 0px;</span></span><br><span class="line"><span class="comment">  margin-bottom: 60px;</span></span><br><span class="line"><span class="comment">  padding: 25px;</span></span><br><span class="line"><span class="comment">  -webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);</span></span><br><span class="line"><span class="comment">  -moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br></pre></td></tr></table></figure><p></p><h5 id="更新主题"><a href="#更新主题" class="headerlink" title="更新主题"></a>更新主题</h5><p>可以通过如下命令更新到最新的 master 分支<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> themes/next</span><br><span class="line">git stash pull</span><br><span class="line">git pull</span><br><span class="line">git stash pop</span><br></pre></td></tr></table></figure><p></p><h3 id="加入广告"><a href="#加入广告" class="headerlink" title="加入广告"></a>加入广告</h3><p>我这里用的是 <code>Google AdSense</code>，网络问题请自行解决</p><ol><li><p>访问 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9pbnRsL3poLUNOX2NuL2Fkc2Vuc2Uvc3RhcnQv" title="https://www.google.com/intl/zh-CN_cn/adsense/start/">Google AdSense<i class="fa fa-external-link"></i></span>，点击 <code>立即注册</code>，然后填各种资料，最后生成一段代码，我的是</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  (adsbygoogle = window.adsbygoogle || []).push(&#123;</span></span><br><span class="line"><span class="undefined">    google_ad_client: "ca-pub-6923016589675745",</span></span><br><span class="line"><span class="undefined">    enable_page_level_ads: true</span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编辑 <code>themes/next/layout/_custom/head.swig</code> 文件，粘贴代码（稍作修改，添加一些变量及控制）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.google_adsense.enable %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    (adsbygoogle = window.adsbygoogle || []).push(&#123;</span></span><br><span class="line"><span class="undefined">      google_ad_client: "&#123;&#123; theme.google_adsense.google_ad_client &#125;&#125;",</span></span><br><span class="line"><span class="undefined">      enable_page_level_ads: true</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li><li><p>在主题配置文件 <code>source/_data/next.yml</code> 中添加下面代码</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Google AdSense</span></span><br><span class="line"><span class="attr">google_adsense:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  google_ad_client:</span> <span class="string">ca-pub-6923016589675745</span></span><br></pre></td></tr></table></figure></li><li><p>等待审核通过，好运。如果失败，可再次申请。</p></li></ol><h3 id="CDN-加速"><a href="#CDN-加速" class="headerlink" title="CDN 加速"></a>CDN 加速</h3><p>配置 <code>font-awesome</code> <code>jquery</code> <code>velocity</code> 的 CDN 加速，在主题配置文件 <code>source/_data/next.yml</code> 中，修改 <code>vendors</code> 下的配置<br></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  jquery:</span> <span class="string">//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js</span></span><br><span class="line"><span class="attr">  velocity:</span> <span class="string">//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js</span></span><br><span class="line"><span class="attr">  velocity_ui:</span> <span class="string">//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js</span></span><br><span class="line"><span class="attr">  fontawesome:</span> <span class="string">//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css</span></span><br></pre></td></tr></table></figure><p></p><h3 id="静态资源压缩"><a href="#静态资源压缩" class="headerlink" title="静态资源压缩"></a>静态资源压缩</h3><ol><li><p>如果未安装 <code>gulo</code>，在 Shell 中执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp -g</span><br></pre></td></tr></table></figure></li><li><p>执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp -g</span><br><span class="line">yarn add -D gulp gulp-clean-css gulp-uglify gulp-htmlmin gulp-htmlclean gulp-imagemin</span><br></pre></td></tr></table></figure></li><li><p>在项目根目录下新建 <code>gulpfile.js</code> 文件，内容如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> cleancss = <span class="built_in">require</span>(<span class="string">'gulp-clean-css'</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">'gulp-htmlmin'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlclean = <span class="built_in">require</span>(<span class="string">'gulp-htmlclean'</span>);</span><br><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>);</span><br><span class="line"><span class="comment">// 压缩css文件</span></span><br><span class="line">gulp.task(<span class="string">'clean-css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/**/*.css'</span>)</span><br><span class="line">  .pipe(cleancss())</span><br><span class="line">  .pipe(gulp.dest(<span class="string">'./public'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 压缩html文件</span></span><br><span class="line">gulp.task(<span class="string">'minify-html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/**/*.html'</span>)</span><br><span class="line">  .pipe(htmlclean())</span><br><span class="line">  .pipe(htmlmin(&#123;</span><br><span class="line">    removeComments: <span class="literal">true</span>,</span><br><span class="line">    minifyJS: <span class="literal">true</span>,</span><br><span class="line">    minifyCSS: <span class="literal">true</span>,</span><br><span class="line">    minifyURLs: <span class="literal">true</span>,</span><br><span class="line">  &#125;))</span><br><span class="line">  .pipe(gulp.dest(<span class="string">'./public'</span>))</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 压缩js文件</span></span><br><span class="line">gulp.task(<span class="string">'minify-js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src([<span class="string">'./public/**/.js'</span>,<span class="string">'!./public/js/**/*min.js'</span>])</span><br><span class="line">        .pipe(uglify())</span><br><span class="line">        .pipe(gulp.dest(<span class="string">'./public'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 压缩 public/demo 目录内图片</span></span><br><span class="line">gulp.task(<span class="string">'minify-images'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src(<span class="string">'./public/demo/**/*.*'</span>)</span><br><span class="line">        .pipe(imagemin(&#123;</span><br><span class="line">          optimizationLevel: <span class="number">7</span>, <span class="comment">//类型：Number  默认：3  取值范围：0-7（优化等级）</span></span><br><span class="line">          progressive: <span class="literal">true</span>, <span class="comment">//类型：Boolean 默认：false 无损压缩jpg图片</span></span><br><span class="line">          interlaced: <span class="literal">false</span>, <span class="comment">//类型：Boolean 默认：false 隔行扫描gif进行渲染</span></span><br><span class="line">          multipass: <span class="literal">false</span>, <span class="comment">//类型：Boolean 默认：false 多次优化svg直到完全优化</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">'./public/uploads'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 默认任务</span></span><br><span class="line">gulp.task(<span class="string">'default'</span>, gulp.parallel(<span class="string">'minify-html'</span>, <span class="string">'clean-css'</span>, <span class="string">'minify-js'</span>, <span class="string">'minify-images'</span>));</span><br></pre></td></tr></table></figure></li><li><p>以后只需要在每次 <code>hexo generate</code> 后，执行一下 <code>gulp</code> 就可以实现对静态文件的压缩，之后再执行 <code>hexo deploy</code> 命令发布。写一下代码，方便复制：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br><span class="line">gulp</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></li></ol><h3 id="功能增强"><a href="#功能增强" class="headerlink" title="功能增强"></a>功能增强</h3><h4 id="标签插件"><a href="#标签插件" class="headerlink" title="标签插件"></a>标签插件</h4><p>标签插件用法参考<span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy9kb2NzL3RhZy1wbHVnaW5zLw==" title="https://theme-next.org/docs/tag-plugins/">官网<i class="fa fa-external-link"></i></span></p><h5 id="Note-标签-Bootstrap-Callout"><a href="#Note-标签-Bootstrap-Callout" class="headerlink" title="Note 标签 - Bootstrap Callout"></a>Note 标签 - Bootstrap Callout</h5><p>在主题配置文件 <code>source/_data/next.yml</code> 中，修改 <code>note</code> 下的配置</p><ul><li><code>style: modern</code></li><li><code>icons: true</code></li><li><code>border_radius: 0</code></li><li><code>light_bg_offset: -3</code></li></ul><h5 id="Tabs-标签支持"><a href="#Tabs-标签支持" class="headerlink" title="Tabs 标签支持"></a>Tabs 标签支持</h5><p><code>tabs.transition.tabs: true</code></p><h5 id="PDF-标签支持"><a href="#PDF-标签支持" class="headerlink" title="PDF 标签支持"></a>PDF 标签支持</h5><p>修改配置 <code>pdf.enable: true</code></p><h5 id="Mermaid-gantt-图标签支持"><a href="#Mermaid-gantt-图标签支持" class="headerlink" title="Mermaid gantt 图标签支持"></a>Mermaid gantt 图标签支持</h5><p>修改配置 <code>mermaid.enable: true</code></p><h4 id="数学方程式渲染支持"><a href="#数学方程式渲染支持" class="headerlink" title="数学方程式渲染支持"></a>数学方程式渲染支持</h4><p>数学方程式渲染引擎可以使用 <code>mathjax</code> 或 <code>katex</code>，由 <code>math.engine</code> 项配置，将 <code>math.enable</code> 修改为 <code>true</code> 即可开启</p><h4 id="启用-Fancybox"><a href="#启用-Fancybox" class="headerlink" title="启用 Fancybox"></a>启用 Fancybox</h4><p>修改配置<br></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">fancybox:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  fancybox:</span> <span class="string">//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js</span></span><br><span class="line"><span class="attr">  fancybox_css:</span> <span class="string">//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css</span></span><br></pre></td></tr></table></figure><p></p><h4 id="启用书签功能"><a href="#启用书签功能" class="headerlink" title="启用书签功能"></a>启用书签功能</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">bookmark:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  auto:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  bookmark:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js</span></span><br></pre></td></tr></table></figure><h4 id="启用顶部阅读进度条"><a href="#启用顶部阅读进度条" class="headerlink" title="启用顶部阅读进度条"></a>启用顶部阅读进度条</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">reading_progress:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  reading_progress:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-reading-progress@1/reading_progress.min.js</span></span><br></pre></td></tr></table></figure><h4 id="启用顶部加载进度条"><a href="#启用顶部加载进度条" class="headerlink" title="启用顶部加载进度条"></a>启用顶部加载进度条</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pace:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  pace:</span> <span class="string">//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js</span></span><br><span class="line"><span class="attr">  pace_css:</span> <span class="string">//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.min.css</span></span><br></pre></td></tr></table></figure><h4 id="启用-FastClick"><a href="#启用-FastClick" class="headerlink" title="启用 FastClick"></a>启用 FastClick</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">fastclick:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  fastclick:</span> <span class="attr">https://cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js</span></span><br></pre></td></tr></table></figure><h4 id="启用-Jquery-Lazyload-图像延迟加载"><a href="#启用-Jquery-Lazyload-图像延迟加载" class="headerlink" title="启用 Jquery Lazyload 图像延迟加载"></a>启用 Jquery Lazyload 图像延迟加载</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">lazyload:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  lazyload:</span> <span class="string">//cdn.jsdelivr.net/npm/jquery_lazyload@1/jquery.lazyload.min.js</span></span><br></pre></td></tr></table></figure><h4 id="启用-Quicklink-预加载"><a href="#启用-Quicklink-预加载" class="headerlink" title="启用 Quicklink 预加载"></a>启用 Quicklink 预加载</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">quicklink:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  quicklink:</span> <span class="string">//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js</span></span><br></pre></td></tr></table></figure><h4 id="启用汉字标准格式支持"><a href="#启用汉字标准格式支持" class="headerlink" title="启用汉字标准格式支持"></a>启用汉字标准格式支持</h4><p>启用方式就是直接按照下面修改主题配置文件 <code>source/_data/next.yml</code>，我没有启用<br></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">han:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  han:</span> <span class="string">//cdnjs.cloudflare.com/ajax/libs/Han/3.3.0/han.min.css</span></span><br></pre></td></tr></table></figure><p></p><h4 id="启用盘古支持——在中英文之间自动添加空格"><a href="#启用盘古支持——在中英文之间自动添加空格" class="headerlink" title="启用盘古支持——在中英文之间自动添加空格"></a>启用盘古支持——在中英文之间自动添加空格</h4><ol><li>在主题配置文件 <code>source/_data/next.yml</code> 中，修改 <code>pangu: true</code></li><li>不使用 CDN 的话，需要安装 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQvdGhlbWUtbmV4dC1wYW5ndQ==" title="https://github.com/theme-next/theme-next-pangu">theme-next-pangu<i class="fa fa-external-link"></i></span>，我这里使用 CDN 加速，直接修改 <code>vendors.pangu</code> 配置<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  pangu:</span> <span class="string">//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="内容分享"><a href="#内容分享" class="headerlink" title="内容分享"></a>内容分享</h4><p><code>百度分享</code>太丑，<code>Likely</code> 没有本土化，不支持微信什么的，这里使用 <code>NeedMoreShare2</code></p><ol><li><p>不在本地加依赖了，直接使用 CDN，修改主题配置文件 <code>source/_data/next.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  needmoreshare2_js:</span> <span class="attr">https://cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js</span></span><br><span class="line"><span class="attr">  needmoreshare2_css:</span> <span class="attr">https://cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css</span></span><br></pre></td></tr></table></figure></li><li><p>修改如下配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">needmoreshare2:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  postbottom:</span></span><br><span class="line"><span class="attr">    enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    options:</span></span><br><span class="line"><span class="attr">      networks:</span> <span class="string">Weibo,Wechat,Douban,QQZone,Twitter,Facebook,Linkedin,Mailto,Evernote</span></span><br><span class="line"><span class="attr">  float:</span></span><br><span class="line"><span class="attr">    enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    options:</span></span><br><span class="line"><span class="attr">      networks:</span> <span class="string">Weibo,Wechat,Douban,QQZone,Twitter,Facebook,Linkedin,Mailto,Evernote</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="评论系统"><a href="#评论系统" class="headerlink" title="评论系统"></a>评论系统</h4><p>我这里使用 <span class="exturl" data-url="aHR0cHM6Ly9saXZlcmUuY29tLw==" title="https://livere.com/">LiveRe<i class="fa fa-external-link"></i></span>，注册后安装一个免费的 City 版本，在安装代码中找到 <code>data-uid</code>，然后修改主题配置文件 <code>source/_data/next.yml</code>，打开 <code>livere_uid</code> 的注释，并填入 <code>data-uid</code></p><h4 id="在线聊天系统"><a href="#在线聊天系统" class="headerlink" title="在线聊天系统"></a>在线聊天系统</h4><p>这里没有使用 <code>NexT</code> 官方推荐的，使用的是 <span class="exturl" data-url="aHR0cDovL3d3dy5kYW92b2ljZS5pby8=" title="http://www.daovoice.io/">DaoVoice<i class="fa fa-external-link"></i></span>，安装方法我参考了<span class="exturl" data-url="aHR0cHM6Ly9ob3hpcy5naXRodWIuaW8vaGV4by1uZXh0LWRhb3ZvaWNlLmh0bWwjJUU2JUIzJUE4JUU1JTg2JThD" title="https://hoxis.github.io/hexo-next-daovoice.html#%E6%B3%A8%E5%86%8C">这里<i class="fa fa-external-link"></i></span></p><ol><li><p>注册之后，选择<code>接入</code>，编程语言为 <code>JavaScript</code>，会出现下面这种代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">(<span class="function"><span class="keyword">function</span>(<span class="params">i,s,o,g,r,a,m</span>)</span>&#123;i[<span class="string">"DaoVoiceObject"</span>]=r;i[r]=i[r]||<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;(i[r].q=i[r].q||[]).push(<span class="built_in">arguments</span>)&#125;,i[r].l=<span class="number">1</span>*<span class="keyword">new</span> <span class="built_in">Date</span>();a=s.createElement(o),m=s.getElementsByTagName(o)[<span class="number">0</span>];a.async=<span class="number">1</span>;a.src=g;a.charset=<span class="string">"utf-8"</span>;m.parentNode.insertBefore(a,m)&#125;)(<span class="built_in">window</span>,<span class="built_in">document</span>,<span class="string">"script"</span>,(<span class="string">'https:'</span> == <span class="built_in">document</span>.location.protocol ? <span class="string">'https:'</span> : <span class="string">'http:'</span>) + <span class="string">"//widget.daovoice.io/widget/XXXXXXXX.js"</span>,<span class="string">"daovoice"</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">daovoice(<span class="string">'init'</span>, &#123;</span><br><span class="line">  app_id: <span class="string">"XXXXXXXX"</span></span><br><span class="line">&#125;);</span><br><span class="line">daovoice(<span class="string">'update'</span>);</span><br></pre></td></tr></table></figure></li><li><p><code>themes/next/layout/_custom/head.swig</code> 文件中添加如下代码（修改一下 <code>&lt;/script&gt;</code> 结束标签的位置，并且将 <code>app_id</code> 做成变量）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if theme.daovoice.enable %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  (<span class="function"><span class="keyword">function</span>(<span class="params">i,s,o,g,r,a,m</span>)</span>&#123;i[<span class="string">"DaoVoiceObject"</span>]=r;i[r]=i[r]||<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;(i[r].q=i[r].q||[]).push(<span class="built_in">arguments</span>)&#125;,i[r].l=<span class="number">1</span>*<span class="keyword">new</span> <span class="built_in">Date</span>();a=s.createElement(o),m=s.getElementsByTagName(o)[<span class="number">0</span>];a.async=<span class="number">1</span>;a.src=g;a.charset=<span class="string">"utf-8"</span>;m.parentNode.insertBefore(a,m)&#125;)(<span class="built_in">window</span>,<span class="built_in">document</span>,<span class="string">"script"</span>,(<span class="string">'https:'</span> == <span class="built_in">document</span>.location.protocol ? <span class="string">'https:'</span> : <span class="string">'http:'</span>) + <span class="string">"//widget.daovoice.io/widget/&#123;&#123; theme.daovoice.daovoice_app_id &#125;&#125;.js"</span>,<span class="string">"daovoice"</span>)</span></span><br><span class="line"><span class="javascript">  daovoice(<span class="string">'init'</span>, &#123;</span></span><br><span class="line"><span class="javascript">    app_id: <span class="string">"&#123;&#123; theme.daovoice.daovoice_app_id &#125;&#125;"</span></span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="javascript">  daovoice(<span class="string">'update'</span>);</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li><li><p>在主题配置文件 <code>source/_data/next.yml</code> 中添加下面代码，<code>XXXXXXXX</code> 是前面获取到的 <code>app_id</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DaoVoice 在线聊天</span></span><br><span class="line"><span class="attr">daovoice:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  daovoice_app_id:</span> <span class="string">XXXXXXXX</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><ol><li>执行命令 <code>yarn add -D hexo-deployer-git</code></li><li><p>部署配置，在站点配置文件 <code>_config.yml</code> 中，找到 <code>deploy</code>，在其节点下删除 <code>type</code>，然后添加如下配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span> <span class="string">git@gitlab.com:wdmcheng/wdmcheng.gitlab.io.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure></li><li><p>执行下面的命令，清理、生成静态文件、部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">gulp</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></li></ol><h2 id="站长工具"><a href="#站长工具" class="headerlink" title="站长工具"></a>站长工具</h2><h3 id="阅读量统计工具"><a href="#阅读量统计工具" class="headerlink" title="阅读量统计工具"></a>阅读量统计工具</h3><h4 id="Firebase"><a href="#Firebase" class="headerlink" title="Firebase"></a>Firebase</h4><p>要使用 Firebase 需要梯子，不只是配置过程，用户访问时如果不能连接服务，也是没有办法统计的，因此不建议</p><ol><li>注册或登录 <span class="exturl" data-url="aHR0cHM6Ly9jb25zb2xlLmZpcmViYXNlLmdvb2dsZS5jb20v" title="https://console.firebase.google.com/">Firebase<i class="fa fa-external-link"></i></span>，配置好项目，获取到 <code>网络 API 密钥</code> 和 <code>项目 ID</code>，然后修改主题配置文件 <code>source/_data/next.yml</code> 的 <code>firestore</code> 部分，如下<ul><li><code>enable: true</code></li><li><code>apiKey: #&lt;网络 API 密钥&gt;</code></li><li><code>projectId: #&lt;项目 ID&gt;</code></li></ul></li><li><code>Firebase 控制台</code>中，进入 <code>开发 &gt; Database</code>，创建一个非测试的数据库，之后进入<code>规则</code>，将 <code>allow read, write: if false;</code> 改为 <code>allow read, write: if true;</code>，然后发布</li></ol><h4 id="不蒜子"><a href="#不蒜子" class="headerlink" title="不蒜子"></a>不蒜子</h4><ol><li>修改主题配置文件 <code>source/_data/next.yml</code>，将 <code>busuanzi_count.enable</code> 改为 <code>true</code></li><li>这里只使用不蒜子的站点统计，文章阅读量交给 <code>LeanCloud</code>，因此将 <code>busuanzi_count.post_views</code> 改为 <code>false</code></li><li>页面底部的<code>访客数</code>图标修改一下，<code>busuanzi_count.total_visitors_icon</code> 的值从 <code>user</code> 改为 <code>users</code></li></ol><h4 id="LeanCloud"><a href="#LeanCloud" class="headerlink" title="LeanCloud"></a>LeanCloud</h4><p><code>LeanCloud</code> 的相关配置请参考<br><span class="exturl" data-url="aHR0cHM6Ly9sZWFmZXJ4Lm9ubGluZS8yMDE4LzAyLzExL2xjLXNlY3VyaXR5Lw==" title="https://leaferx.online/2018/02/11/lc-security/">Leancloud访客统计插件重大安全漏洞修复指南<i class="fa fa-external-link"></i></span></p><ol><li>到 <span class="exturl" data-url="aHR0cHM6Ly9sZWFuY2xvdWQuY24v" title="https://leancloud.cn/">LeanCloud 官网<i class="fa fa-external-link"></i></span>注册，可以直接使用 <code>GitHub</code> 账号注册</li><li>创建一个开发版的应用</li><li>建立一个无限制的 <code>Counter</code> 类，之后进入设置拿到 <code>App ID</code> 及 <code>App Key</code></li><li>修改主题配置文件 <code>source/_data/next.yml</code> 中的 <code>leancloud_visitors</code> 部分<ul><li><code>enable: true</code></li><li><code>app_id: #&lt;App ID&gt;</code></li><li><code>app_key: #&lt;App Key&gt;</code></li><li><code>betterPerformance: true</code></li></ul></li><li>在 <code>LeanCloud</code> 的设置页面，进入<code>安全中心</code>，添加<code>Web 安全域名</code>，注意协议、域名和端口号需严格一致，我这里是 <code>https://www.wdmcheng.cn</code></li><li><p>部署云引擎以保证访客数量不被随意篡改</p><ol><li>打开 <code>LeanCloud</code> 的<code>云引擎 &gt; 部署</code>，点击<code>在线编辑</code></li><li><p><code>创建函数 &gt; Hook</code>，<code>Hook</code> 选择 <code>beforeUpdate</code>，<code>Class</code> 选择 <code>Counter</code>，然后粘贴下面代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> query = <span class="keyword">new</span> AV.Query(<span class="string">"Counter"</span>);</span><br><span class="line"><span class="keyword">if</span> (request.object.updatedKeys.indexOf(<span class="string">'time'</span>) !== <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> query.get(request.object.id).then(<span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj.get(<span class="string">"time"</span>) + <span class="number">1</span> !== request.object.get(<span class="string">"time"</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AV.Cloud.Error(<span class="string">'Invalid update!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>注释</code>处填个描述，我这里写的<code>防止访客数量被随意篡改</code></p></li><li>然后要<code>部署</code>一下才可以生效</li></ol></li><li><p>配置数据库记录只可以本地增加，禁止删除</p><ol><li><p>打开站点配置文件 <code>_config.yml</code>，添加以下配置，<code>app_id</code> 与 <code>app_key</code> 是 <code>LeanCloud</code> 中的，<code>username</code> 与 <code>password</code> 是授权可以 <code>create</code> 的用户名与密码</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">leancloud_counter_security:</span></span><br><span class="line"><span class="attr">  enable_sync:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  app_id:</span> <span class="comment">#&lt;App ID&gt;</span></span><br><span class="line"><span class="attr">  app_key:</span> <span class="comment">#&lt;App Key&gt;</span></span><br><span class="line"><span class="attr">  username:</span></span><br><span class="line"><span class="attr">  password:</span></span><br></pre></td></tr></table></figure></li><li><p>执行命令 <code>yarn add -D hexo-leancloud-counter-security</code> 安装相关组件</p></li><li>执行命令 <code>hexo lc-counter register &lt;&lt;username&gt;&gt; &lt;&lt;password&gt;&gt;</code> 创建用户</li><li>打开 <code>LeanCloud</code> 的<code>存储</code>，进入 <code>Counter</code> 类，选择<code>其他 &gt; 权限设定</code>，将 <code>create</code> 的权限设置为<code>指定用户</code>，选择刚才创建的用户，<code>delete</code> 的权限也设置为<code>指定用户</code>，但用户和角色都留空</li><li>站点配置文件 <code>_config.yml</code> 的 <code>deploy</code> 节点下添加 <code>- type: leancloud_counter_security_sync</code></li></ol></li><li>配置 CDN 加速，修改 <code>vendors.leancloud</code> 配置<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vendors:</span></span><br><span class="line"><span class="attr">  leancloud:</span> <span class="string">//cdn.jsdelivr.net/npm/leancloud-storage@3/dist/av-min.js</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="数据分析工具"><a href="#数据分析工具" class="headerlink" title="数据分析工具"></a>数据分析工具</h3><h4 id="Google-Analytics"><a href="#Google-Analytics" class="headerlink" title="Google Analytics"></a>Google Analytics</h4><h5 id="启用-Google-Analytics"><a href="#启用-Google-Analytics" class="headerlink" title="启用 Google Analytics"></a>启用 Google Analytics</h5><ol><li>启用 <code>Google Analytics</code>，前往<span class="exturl" data-url="aHR0cHM6Ly9hbmFseXRpY3MuZ29vZ2xlLmNvbQ==" title="https://analytics.google.com">Google Analytics<i class="fa fa-external-link"></i></span>，注册或登录，获取到 <code>Google 跟踪 ID</code></li><li>修改主题配置文件 <code>source/_data/next.yml</code>，将 <code>google_analytics</code> 部分的注释打开，并且在 <code>google_analytics.tracking_id</code> 填入 <code>UA-XXXXXXXX-X</code> 形式的 <code>Google 跟踪 ID</code></li></ol><h5 id="关联-Google-Search-Console"><a href="#关联-Google-Search-Console" class="headerlink" title="关联 Google Search Console"></a>关联 Google Search Console</h5><p>若要关联 <code>Google Search Console</code>，这里不能使用 <code>HTML 文件</code> 方式验证，因为使用 <code>Hexo</code> 部署时，会自动移除多余的 html 文件。这里采用 <code>Google Analytics</code> 方式验证，那么在启用了 <code>Google Analytics</code> 后必须部署，然后根据 Google 的向导操作</p><h5 id="关联-Google-AdSense"><a href="#关联-Google-AdSense" class="headerlink" title="关联 Google AdSense"></a>关联 Google AdSense</h5><p>直接在 <code>Google Analytics</code> 的管理页面关联就可以了</p><h4 id="百度统计"><a href="#百度统计" class="headerlink" title="百度统计"></a>百度统计</h4><ol><li><p>打开<span class="exturl" data-url="aHR0cHM6Ly90b25namkuYmFpZHUuY29t" title="https://tongji.baidu.com">百度统计<i class="fa fa-external-link"></i></span>，注册、建立网站，完成后会有一个下面这种的<code>统计代码</code>，复制 <code>https://hm.baidu.com/hm.js?xxxxxxxx</code> 中的 <code>xxxxxxxx</code>，得到<code>统计 ID</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> _hmt = _hmt || [];</span></span><br><span class="line"><span class="javascript">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> hm = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span></span><br><span class="line"><span class="javascript">  hm.src = <span class="string">"https://hm.baidu.com/hm.js?xxxxxxxx"</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> s = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"script"</span>)[<span class="number">0</span>]; </span></span><br><span class="line"><span class="undefined">  s.parentNode.insertBefore(hm, s);</span></span><br><span class="line"><span class="undefined">&#125;)();</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>打开主题配置文件 <code>source/_data/next.yml</code>，找到 <code>baidu_analytics</code>，打开注释，并修改为 <code>baidu_analytics: xxxxxxxx</code></p></li></ol><h3 id="搜索引擎相关"><a href="#搜索引擎相关" class="headerlink" title="搜索引擎相关"></a>搜索引擎相关</h3><h4 id="搜索引擎优化（SEO）"><a href="#搜索引擎优化（SEO）" class="headerlink" title="搜索引擎优化（SEO）"></a>搜索引擎优化（SEO）</h4><ol><li><p>在主题配置文件 <code>source/_data/next.yml</code> 中，修改如下配置</p><ul><li><code>disable_baidu_transformation: true</code></li><li><code>seo: true</code></li><li><code>index_with_subtitle: true</code></li><li><code>exturl: true</code></li><li><code>baidu_push: true</code></li></ul><p>各种 Webmaster tools verification 需要到各自官网获取，然后填写到配置文件中，详细说明可参考<span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy9kb2NzL3RoZW1lLXNldHRpbmdzL3Nlby8jV2VibWFzdGVyLVRvb2xz" title="https://theme-next.org/docs/theme-settings/seo/#Webmaster-Tools">NexT 主题官网<i class="fa fa-external-link"></i></span>，<br>我这里开了 <code>google_site_verification</code> <code>bing_site_verification</code> <code>baidu_site_verification</code> 三个，可以开三个页签分别配置到待验证的环节，然后配好 <code>NexT</code>，一次发布，再分别点验证</p></li><li><p>减少出站链接能够有效防止权重分散，这里安装 <code>hexo-autonofollow</code>，该工具可以在出站链接上自动添加属性 <code>external nofollow noopener noreferrer</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D hexo-autonofollow</span><br></pre></td></tr></table></figure></li><li><p>在站点配置文件 <code>_config.yml</code> 中添加如下配置，友链不想添加 <code>nofollow</code> 属性的，添加到 <code>exclude</code> 里</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nofollow:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  exclude:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">友链地址1</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">友链地址2</span></span><br></pre></td></tr></table></figure></li><li><p>主题配置文件中默认的 <code>permalink</code> 是 <code>:year/:month/:day/:title/</code>，这对搜索引擎不友好，直接修改一下链接层级，变成 <code>:title</code> 或者 <code>:year-:month-:day-:title</code></p></li></ol><h4 id="搜索引擎抓取"><a href="#搜索引擎抓取" class="headerlink" title="搜索引擎抓取"></a>搜索引擎抓取</h4><p>这里参考 <span class="exturl" data-url="aHR0cHM6Ly9ob3hpcy5naXRodWIuaW8vSGV4bytOZXh0JTIwU0VPJUU0JUJDJTk4JUU1JThDJTk2Lmh0bWw=" title="https://hoxis.github.io/Hexo+Next%20SEO%E4%BC%98%E5%8C%96.html">Hexo博客Next主题SEO优化方法<i class="fa fa-external-link"></i></span></p><ol><li><p>首先安装插件，自动生成 <code>sitemap</code> 文件，一个传统的，一个百度的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D hexo-generator-sitemap hexo-generator-baidu-sitemap</span><br></pre></td></tr></table></figure></li><li><p>安装完部署，这时网站就有了两个 <code>sitemap</code> 了</p></li><li>前面已经在 <code>Google Search Console</code> 和<span class="exturl" data-url="aHR0cHM6Ly96aXl1YW4uYmFpZHUuY29t" title="https://ziyuan.baidu.com">百度搜索资源平台<i class="fa fa-external-link"></i></span>中添加验证了站点，现在可以直接提交 <code>sitemap.xml</code> 了，百度提交 <code>baidusitemap.xml</code></li><li><code>github</code> 禁止百度爬虫，好在百度支持主动推送，因此还需要添加一个主动推送的插件，执行命令 <code>yarn add -D hexo-baidu-url-submit</code></li><li><p>在站点配置文件 <code>_config.yml</code> 中，参考下面配置、注释及主动推送的接口调用地址添加配置（最后三个是<code>熊掌号</code>相关的，没有注册熊掌号则不写）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">baidu_url_submit:</span></span><br><span class="line"><span class="attr">  count:</span> <span class="number">1000</span> <span class="comment">## 提交最新的一个链接</span></span><br><span class="line"><span class="attr">  host:</span> <span class="string">alili.tech</span> <span class="comment">## 在百度站长平台中注册的域名</span></span><br><span class="line"><span class="attr">  token:</span> <span class="string">xxxxx</span> <span class="comment">## 请注意这是您的秘钥，所以请不要把博客源代码发布在公众仓库里!</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">baidu_urls.txt</span> <span class="comment">## 文本文档的地址，新链接会保存在此文本文档里</span></span><br><span class="line"><span class="attr">  xz_appid:</span> <span class="string">'xxxxxx'</span> <span class="comment">## 你的熊掌号 appid</span></span><br><span class="line"><span class="attr">  xz_token:</span> <span class="string">'xxxxxx'</span> <span class="comment">## 你的熊掌号 token</span></span><br><span class="line"><span class="attr">  xz_count:</span> <span class="number">10</span> <span class="comment">## 从所有的提交的数据当中选取最新的10条，该数量跟你的熊掌号而定</span></span><br></pre></td></tr></table></figure></li><li><p>在 <code>deploy</code> 下增加下面的类型（没注册熊掌号则不添加熊掌号的类型）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- type:</span> <span class="string">baidu_url_submitter</span> <span class="comment"># 百度</span></span><br><span class="line"><span class="attr">- type:</span> <span class="string">baidu_xz_url_submitter</span> <span class="comment"># 百度熊掌号</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="添加热度排行榜"><a href="#添加热度排行榜" class="headerlink" title="添加热度排行榜"></a>添加热度排行榜</h2><p>这里参考了 <span class="exturl" data-url="aHR0cHM6Ly9ob3hpcy5naXRodWIuaW8vaGV4by1uZXh0LXJlYWQtcmFuay5odG1s" title="https://hoxis.github.io/hexo-next-read-rank.html">hexo next 新增阅读排行页面<i class="fa fa-external-link"></i></span></p><ol><li><p>排行榜源码如下（修改了文章链接地址），其中 <code>leancloud_uri</code> <code>leancloud_appid</code> <code>leancloud_appkey</code> 需要替换一下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"top"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"leancloud_uri"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">AV.initialize(<span class="string">"leancloud_appid"</span>, <span class="string">"leancloud_appkey"</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> time = <span class="number">0</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> title = <span class="string">""</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> url = <span class="string">""</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> query = <span class="keyword">new</span> AV.Query(<span class="string">'Counter'</span>);</span></span><br><span class="line"><span class="javascript">query.notEqualTo(<span class="string">'id'</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">query.descending(<span class="string">'time'</span>);</span></span><br><span class="line"><span class="undefined">query.limit(1000);</span></span><br><span class="line"><span class="javascript">query.find().then(<span class="function"><span class="keyword">function</span> (<span class="params">todo</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++)&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> result = todo[i].attributes;</span></span><br><span class="line"><span class="undefined">    time = result.time;</span></span><br><span class="line"><span class="undefined">    title = result.title;</span></span><br><span class="line"><span class="undefined">    url = result.url;</span></span><br><span class="line"><span class="xml">    const content="<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">'#1C1C1C'</span>&gt;</span>【文章热度:"+time+"℃】<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'"+url+"'</span>&gt;</span>"+title+"<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span>";</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">"top"</span>).innerHTML += content</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">"error"</span>);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>执行 <code>hexo new page top</code> 命令，创建一个 <code>top</code> 页面，编辑该页面，在头部描述区域添加 <code>comments: false</code> 关闭评论功能，然后粘贴上述代码</p></li><li>修改主题配置文件 <code>source/_data/next.yml</code>，在 <code>menu</code> 下添加 <code>top: /top/ || signal</code></li><li>编辑 <code>themes/next/languages/zh-CN.yml</code> 语言文件，在 <code>menu</code> 下添加 <code>top: /top/ || signal</code></li></ol><h2 id="自动化部署"><a href="#自动化部署" class="headerlink" title="自动化部署"></a>自动化部署</h2><p>我这里是使用 <code>GitLab</code> 私有仓库保存源码（因为含有密钥等信息），使用 <code>gitlab-ci</code> 自动部署的到 GitLab 的仓库，然后使用 GitLab 的镜像仓库功能推送到 <code>github</code> 与 <code>coding</code>，这样每次写完文章，合并到 <code>master</code> 分支即可</p><ol><li>使用 <code>GitHub</code> 的 Pages 服务并配置域名，需要添加 <code>CNAME</code> 文件，为了自动部署，直接新建 <code>source/CNAME</code> 文件，并在里面填写 <code>www.wdmcheng.cn</code></li><li>如果要使用 <code>HTTPS</code>，要先解析到 <code>Coding</code> 的服务，然后开启 <code>Coding Pages</code> 的 <code>HTTPS</code> 功能，待申请下来证书后，再添加国外 IP 解析到 <code>GitHub</code>，最后再申请 <code>GitHub Pages</code> 的 <code>HTTPS</code></li><li>三个月证书到期需要续期时，需要先暂停国外 IP 解析，<code>Coding</code> 续期完成再开启</li><li>自动化部署的工作流配置，参考 <span class="exturl" data-url="aHR0cHM6Ly9naXRsYWIuY29tL3BhZ2VzL2hleG8vdHJlZS9tYXN0ZXI=" title="https://gitlab.com/pages/hexo/tree/master">GitLab Pages examples<i class="fa fa-external-link"></i></span> 和 <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy9kb2NzL2dldHRpbmctc3RhcnRlZC9kZXBsb3ltZW50LyNDb250aW51b3VzLUludGVncmF0aW9u" title="https://theme-next.org/docs/getting-started/deployment/#Continuous-Integration">NexT 主题官网<i class="fa fa-external-link"></i></span>，我这里采用的是 <code>SSH</code> 方式部署的，附上我的 <code>.gitlab-ci.yml</code> 文件<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file is a template, and might need editing before it works on your project.</span></span><br><span class="line"><span class="comment"># Full project: https://gitlab.com/pages/hexo</span></span><br><span class="line"><span class="attr">image:</span> <span class="attr">node:10.15.3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">export</span> <span class="string">TZ='Asia/Shanghai'</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="bullet">--global</span> <span class="string">user.name</span> <span class="string">"wdmcheng"</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="bullet">--global</span> <span class="string">user.email</span> <span class="string">"idea_2008@126.com"</span></span><br><span class="line"><span class="comment"># Restore last modified time</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">"git ls-files -z | while read -d '' path; do touch -d \"$(git log -1 --format=\"@%ct\" \"$path\")\" \"$path\"; done"</span></span><br><span class="line"><span class="comment"># Install ssh-agent if not already installed, it is required by Docker.</span></span><br><span class="line"><span class="comment"># (change apt-get to yum if you use a CentOS-based image)</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">'which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )'</span></span><br><span class="line"><span class="comment"># Run ssh-agent (inside the build environment)</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">eval</span> <span class="string">$(ssh-agent</span> <span class="bullet">-s)</span></span><br><span class="line"><span class="comment"># Add the SSH key stored in SSH_PRIVATE_KEY variable to the agent store</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">ssh-add</span> <span class="string">&lt;(echo</span> <span class="string">"$DEPLOY_PRIVATE_KEY"</span><span class="string">)</span></span><br><span class="line"><span class="comment"># For Docker builds disable host key checking. Be aware that by adding that</span></span><br><span class="line"><span class="comment"># you are suspectible to man-in-the-middle attacks.</span></span><br><span class="line"><span class="comment"># WARNING: Use this only with the Docker executor, if you use it with shell</span></span><br><span class="line"><span class="comment"># you will overwrite your user's SSH config.</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">mkdir</span> <span class="bullet">-p</span> <span class="string">~/.ssh</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">'[[ -f /.dockerenv ]] &amp;&amp; echo -e "Host *\n\tStrictHostKeyChecking no\n\n" &gt; ~/.ssh/config'</span></span><br><span class="line"><span class="comment"># In order to properly check the server's host key, assuming you created the</span></span><br><span class="line"><span class="comment"># SSH_SERVER_HOSTKEYS variable previously, uncomment the following two lines</span></span><br><span class="line"><span class="comment"># instead.</span></span><br><span class="line"><span class="comment"># - mkdir -p ~/.ssh</span></span><br><span class="line"><span class="comment"># - '[[ -f /.dockerenv ]] &amp;&amp; echo "$SSH_SERVER_HOSTKEYS" &gt; ~/.ssh/known_hosts'</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">apt-get</span> <span class="string">update</span> <span class="bullet">-qq</span> <span class="string">&amp;&amp;</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="bullet">-y</span> <span class="bullet">-qq</span> <span class="string">pandoc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">node_modules/</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">.deploy_git/</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">source/leancloud.memo</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pages:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-cli</span> <span class="string">yarn</span> <span class="string">gulp@^4.0.0</span> <span class="bullet">-g</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">test</span> <span class="bullet">-e</span> <span class="string">package.json</span> <span class="string">&amp;&amp;</span> <span class="string">yarn</span> <span class="string">install</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">hexo</span> <span class="string">clean</span> <span class="string">&amp;&amp;</span> <span class="string">hexo</span> <span class="string">generate</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">gulp</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">hexo</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">public</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">master</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuc2ltb245Ni5vbmxpbmUv" title="https://www.simon96.online/">遇见西门<i class="fa fa-external-link"></i></span>的博文<span class="exturl" data-url="aHR0cHM6Ly93d3cuc2ltb245Ni5vbmxpbmUvMjAxOC8xMC8xMi9oZXhvLXR1dG9yaWFsLw==" title="https://www.simon96.online/2018/10/12/hexo-tutorial/">【持续更新】最全Hexo博客搭建+主题优化+插件配置+常用操作+错误分析<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vdS9jZjVhYmI5OWFiYTc=" title="https://www.jianshu.com/u/cf5abb99aba7">my_杨哥<i class="fa fa-external-link"></i></span>的简书文章<span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8zYTA1MzUxYTM3ZGM=" title="https://www.jianshu.com/p/3a05351a37dc">Hexo的Next主题详细配置<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9sZWFmZXJ4Lm9ubGluZS8=" title="https://leaferx.online/">LEAFERx<i class="fa fa-external-link"></i></span> 的博文 <span class="exturl" data-url="aHR0cHM6Ly9sZWFmZXJ4Lm9ubGluZS8yMDE4LzAyLzExL2xjLXNlY3VyaXR5Lw==" title="https://leaferx.online/2018/02/11/lc-security/">Leancloud访客统计插件重大安全漏洞修复指南<i class="fa fa-external-link"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9ob3hpcy5naXRodWIuaW8v" title="https://hoxis.github.io/">hoxis<i class="fa fa-external-link"></i></span> 的博文 <span class="exturl" data-url="aHR0cHM6Ly9ob3hpcy5naXRodWIuaW8vaGV4by1uZXh0LWRhb3ZvaWNlLmh0bWw=" title="https://hoxis.github.io/hexo-next-daovoice.html">hexo next 配置 DaoVoice 实现在线聊天功能<i class="fa fa-external-link"></i></span>及 <span class="exturl" data-url="aHR0cHM6Ly9ob3hpcy5naXRodWIuaW8vaGV4by1uZXh0LXJlYWQtcmFuay5odG1s" title="https://hoxis.github.io/hexo-next-read-rank.html">hexo next 新增阅读排行页面<i class="fa fa-external-link"></i></span></li></ul></div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 雾都迷城</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.wdmcheng.cn/记录一下本博客搭建过程/" title="记录一下本博客搭建过程">https://www.wdmcheng.cn/记录一下本博客搭建过程/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Hexo/" rel="tag"># Hexo</a> <a href="/tags/NexT/" rel="tag"># NexT</a></div><div class="post-widgets"><div class="social_share"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/macOS调整Launchpad图标大小/" rel="prev" title="macOS调整Launchpad图标大小">macOS调整Launchpad图标大小<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80MzQ0Ni8xOTk4Ng=="></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">雾都迷城</p><div class="site-description motion-element" itemprop="description">手握日月摘星晨，世间无我这般人……嗯……吹大了</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">4</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="cc-license motion-element" itemprop="license"> <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#博客搭建"><span class="nav-number">2.</span> <span class="nav-text">博客搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#准备环境"><span class="nav-number">2.1.</span> <span class="nav-text">准备环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实施方案"><span class="nav-number">2.2.</span> <span class="nav-text">实施方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主题"><span class="nav-number">2.3.</span> <span class="nav-text">主题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#应用主题"><span class="nav-number">2.3.1.</span> <span class="nav-text">应用主题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#主题修改与优化"><span class="nav-number">2.3.2.</span> <span class="nav-text">主题修改与优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RSS-支持"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">RSS 支持</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#修改主题样式"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">修改主题样式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#主页文章只显示摘要"><span class="nav-number">2.3.2.3.</span> <span class="nav-text">主页文章只显示摘要</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#记录文章阅读位置"><span class="nav-number">2.3.2.4.</span> <span class="nav-text">记录文章阅读位置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#字数统计与阅读时长"><span class="nav-number">2.3.2.5.</span> <span class="nav-text">字数统计与阅读时长</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#代码片段复制按钮"><span class="nav-number">2.3.2.6.</span> <span class="nav-text">代码片段复制按钮</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#优化字库访问速度"><span class="nav-number">2.3.2.7.</span> <span class="nav-text">优化字库访问速度</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置菜单项"><span class="nav-number">2.3.2.8.</span> <span class="nav-text">配置菜单项</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加创作共用协议"><span class="nav-number">2.3.2.9.</span> <span class="nav-text">添加创作共用协议</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#文章开始统一添加前言"><span class="nav-number">2.3.2.10.</span> <span class="nav-text">文章开始统一添加前言</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#文章末尾统一添加结束标记"><span class="nav-number">2.3.2.11.</span> <span class="nav-text">文章末尾统一添加结束标记</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加-GitHub-Banner"><span class="nav-number">2.3.2.12.</span> <span class="nav-text">添加 GitHub Banner</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加搜索功能"><span class="nav-number">2.3.2.13.</span> <span class="nav-text">添加搜索功能</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#移动设备适配"><span class="nav-number">2.3.2.14.</span> <span class="nav-text">移动设备适配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Safari-菜单栏着色"><span class="nav-number">2.3.2.15.</span> <span class="nav-text">Safari 菜单栏着色</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自定义滚动条件支持"><span class="nav-number">2.3.2.16.</span> <span class="nav-text">自定义滚动条件支持</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加特效"><span class="nav-number">2.3.2.17.</span> <span class="nav-text">添加特效</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#修改动画"><span class="nav-number">2.3.2.18.</span> <span class="nav-text">修改动画</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加-Live2D-动画角色"><span class="nav-number">2.3.2.19.</span> <span class="nav-text">添加 Live2D 动画角色</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#主页文章添加阴影效果"><span class="nav-number">2.3.2.20.</span> <span class="nav-text">主页文章添加阴影效果</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#更新主题"><span class="nav-number">2.3.2.21.</span> <span class="nav-text">更新主题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#加入广告"><span class="nav-number">2.4.</span> <span class="nav-text">加入广告</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CDN-加速"><span class="nav-number">2.5.</span> <span class="nav-text">CDN 加速</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#静态资源压缩"><span class="nav-number">2.6.</span> <span class="nav-text">静态资源压缩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#功能增强"><span class="nav-number">2.7.</span> <span class="nav-text">功能增强</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#标签插件"><span class="nav-number">2.7.1.</span> <span class="nav-text">标签插件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Note-标签-Bootstrap-Callout"><span class="nav-number">2.7.1.1.</span> <span class="nav-text">Note 标签 - Bootstrap Callout</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Tabs-标签支持"><span class="nav-number">2.7.1.2.</span> <span class="nav-text">Tabs 标签支持</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#PDF-标签支持"><span class="nav-number">2.7.1.3.</span> <span class="nav-text">PDF 标签支持</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Mermaid-gantt-图标签支持"><span class="nav-number">2.7.1.4.</span> <span class="nav-text">Mermaid gantt 图标签支持</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数学方程式渲染支持"><span class="nav-number">2.7.2.</span> <span class="nav-text">数学方程式渲染支持</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用-Fancybox"><span class="nav-number">2.7.3.</span> <span class="nav-text">启用 Fancybox</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用书签功能"><span class="nav-number">2.7.4.</span> <span class="nav-text">启用书签功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用顶部阅读进度条"><span class="nav-number">2.7.5.</span> <span class="nav-text">启用顶部阅读进度条</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用顶部加载进度条"><span class="nav-number">2.7.6.</span> <span class="nav-text">启用顶部加载进度条</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用-FastClick"><span class="nav-number">2.7.7.</span> <span class="nav-text">启用 FastClick</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用-Jquery-Lazyload-图像延迟加载"><span class="nav-number">2.7.8.</span> <span class="nav-text">启用 Jquery Lazyload 图像延迟加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用-Quicklink-预加载"><span class="nav-number">2.7.9.</span> <span class="nav-text">启用 Quicklink 预加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用汉字标准格式支持"><span class="nav-number">2.7.10.</span> <span class="nav-text">启用汉字标准格式支持</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启用盘古支持——在中英文之间自动添加空格"><span class="nav-number">2.7.11.</span> <span class="nav-text">启用盘古支持——在中英文之间自动添加空格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内容分享"><span class="nav-number">2.7.12.</span> <span class="nav-text">内容分享</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#评论系统"><span class="nav-number">2.7.13.</span> <span class="nav-text">评论系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在线聊天系统"><span class="nav-number">2.7.14.</span> <span class="nav-text">在线聊天系统</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#部署"><span class="nav-number">3.</span> <span class="nav-text">部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#站长工具"><span class="nav-number">4.</span> <span class="nav-text">站长工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#阅读量统计工具"><span class="nav-number">4.1.</span> <span class="nav-text">阅读量统计工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Firebase"><span class="nav-number">4.1.1.</span> <span class="nav-text">Firebase</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#不蒜子"><span class="nav-number">4.1.2.</span> <span class="nav-text">不蒜子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LeanCloud"><span class="nav-number">4.1.3.</span> <span class="nav-text">LeanCloud</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据分析工具"><span class="nav-number">4.2.</span> <span class="nav-text">数据分析工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Google-Analytics"><span class="nav-number">4.2.1.</span> <span class="nav-text">Google Analytics</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#启用-Google-Analytics"><span class="nav-number">4.2.1.1.</span> <span class="nav-text">启用 Google Analytics</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#关联-Google-Search-Console"><span class="nav-number">4.2.1.2.</span> <span class="nav-text">关联 Google Search Console</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#关联-Google-AdSense"><span class="nav-number">4.2.1.3.</span> <span class="nav-text">关联 Google AdSense</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#百度统计"><span class="nav-number">4.2.2.</span> <span class="nav-text">百度统计</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#搜索引擎相关"><span class="nav-number">4.3.</span> <span class="nav-text">搜索引擎相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#搜索引擎优化（SEO）"><span class="nav-number">4.3.1.</span> <span class="nav-text">搜索引擎优化（SEO）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#搜索引擎抓取"><span class="nav-number">4.3.2.</span> <span class="nav-text">搜索引擎抓取</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加热度排行榜"><span class="nav-number">5.</span> <span class="nav-text">添加热度排行榜</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动化部署"><span class="nav-number">6.</span> <span class="nav-text">自动化部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#致谢"><span class="nav-number">7.</span> <span class="nav-text">致谢</span></a></li></ol></div></div></div><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> <span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5taWl0Lmdvdi5jbg==">京ICP备202100XXXX号</span> &copy; <span itemprop="copyrightYear">2022</span><span class="with-love" id="animate"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">雾都迷城</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="站点总字数">13k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">12 分钟</span></div><div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> 强力驱动 v3.8.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Gemini</span> v7.1.1</div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-users"></i></span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/npm/fastclick@1/lib/fastclick.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery_lazyload@1/jquery.lazyload.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script><script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-reading-progress@1/reading_progress.min.js"></script><script src="/js/utils.js?v=7.1.1"></script><script src="/js/motion.js?v=7.1.1"></script><script src="/js/affix.js?v=7.1.1"></script><script src="/js/schemes/pisces.js?v=7.1.1"></script><script src="/js/scrollspy.js?v=7.1.1"></script><script src="/js/post-details.js?v=7.1.1"></script><script src="/js/next-boot.js?v=7.1.1"></script><script src="/js/js.cookie.js?v=7.1.1"></script><script src="/js/scroll-cookie.js?v=7.1.1"></script><script src="/js/exturl.js?v=7.1.1"></script><script>window.livereOptions={refer:"记录一下本博客搭建过程/"},function(e,t){var n,r=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,r.parentNode.insertBefore(n,r))}(document,"script")</script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(counter.time + 1);
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
              })
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! More info at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'KxkFsrspt4Gy1MFUvOcKVbVX-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'KxkFsrspt4Gy1MFUvOcKVbVX-gzGzoHsz',
                'X-LC-Key': 'swUGG11MQeG4KxVJ7ycdsmxr',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script><script>$("body").find("div.pdf").length&&$.ajax({type:"GET",url:"//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js",dataType:"script",cache:!0,success:function(){$("body").find("div.pdf").each(function(e,t){PDFObject.embed($(t).attr("target"),$(t),{pdfOpenParams:{navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"},PDFJS_URL:"/lib/pdf/web/viewer.html",height:$(t).attr("height")||"500px"})})}})</script><script>$("body").find("pre.mermaid").length&&$.ajax({type:"GET",url:"//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js",dataType:"script",cache:!0,success:function(){mermaid.initialize({theme:"forest",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})}})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook,Linkedin,Mailto,Evernote"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"middleRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook,Linkedin,Mailto,Evernote"},new needShareButton("#needsharebutton-float",flOptions)</script><script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script><script>pangu.spacingPage()</script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@1/bookmark.min.js"></script><script>bookmark.scrollToMark("auto","#更多")</script><script>$(".highlight").not(".gist .highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=window.pageYOffset||document.documentElement.scrollTop;n.style.top=o+"px",n.style.position="absolute",n.style.opacity="0",n.readOnly=!0,n.value=e,document.body.appendChild(n),n.select(),n.setSelectionRange(0,e.length),n.readOnly=!1,document.execCommand("copy")?$(this).text("复制成功"):$(this).text("复制失败"),n.blur(),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({tagMode:!1,debug:!1,model:{jsonPath:"https://cdn.jsdelivr.net/npm/live2d-widget-model-haruto@1.x/assets/haruto.model.json"},display:{position:"right",width:300,height:600},mobile:{show:!1},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html>